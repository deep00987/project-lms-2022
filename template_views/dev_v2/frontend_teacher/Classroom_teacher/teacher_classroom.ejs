<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="csrf-token" content = "<%= data?.CSRF_TOKEN %>">

  <title>Classroom_LMS</title>

  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <script defer src="https://use.fontawesome.com/releases/v6.1.1/js/all.js" integrity="sha384-xBXmu0dk1bEoiwd71wOonQLyH+VpgR1XcDH3rtxrLww5ajNTuMvBdL5SOiFZnNdp" crossorigin="anonymous"></script>
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
  <script  src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link rel="stylesheet" href="/dev_v2/Classroom_teacher/styles.css">

</head>
<body>
  
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <header class="mdl-layout__header mdl__custom__prop__header">
        <div class="mdl-layout__header-row">
          <!-- Title -->
          <span class="mdl-layout-title"><%= data?.class_room_info[0]?.class_name %></span>
          <!-- Add spacer, to align navigation to the right -->
          <div class="mdl-layout-spacer"></div>
          <!-- Navigation. We hide it in small screens. -->
          <nav class="mdl-navigation mdl-layout--large-screen-only">
            <a class="mdl-navigation__link" href="/development/teacher/classroom/<%= data?.class_room_info[0]?.class_room_id%>">Stream</a>
            <a class="mdl-navigation__link" href="/development/teacher/classroom/<%= data?.class_room_info[0]?.class_room_id%>/people">People</a>
          </nav>
        </div>
      </header>
      <div class="mdl-layout__drawer">
        <span class="mdl-layout-title">Classroom</span>
        <nav class="mdl-navigation">
          <a class="mdl-navigation__link mdl__nav__drawer__item" href="/development/teacher/classroom/<%= data?.class_room_info[0]?.class_room_id%>">Stream</a>
          <a class="mdl-navigation__link mdl__nav__drawer__item" href="/development/teacher/classroom/<%= data?.class_room_info[0]?.class_room_id%>/people">People</a>
          <a class="mdl-navigation__link mdl__nav__drawer__item" href="/development/teacher/home">Home</a>
          <a class="mdl-navigation__link mdl__nav__drawer__item logout__btn__classroom" href="">logout</a>
        </nav>
      </div>

      <main class="mdl-layout__content">
        <div class="classroom__container">
          <!-- grid row 1 take full 12 cells -->
          <div class="classroom__banner">
            <!-- fetch classroom info -->
            <div class="banner__info">
              <div class="">
                <h1 class = "banner__item"><%= data?.class_room_info[0]?.course_name %></h1>
                <h2 class = "banner__item"><%= data?.class_room_info[0]?.class_name %></h2>
                <h2 class = "banner__item">Instructor: <%= data?.teacher_info[0]?.fname %> <%= data?.teacher_info[0]?.lname %></h2>
              </div>
            </div>
          </div>
          <!-- row 2 take 2 cells -->
      
          <div class="classroom__body">
            <div class="classroom__side__bar__container">
              <div class="classroom__side__bar">
                <div class="classroom__side__bar__header">
                  <h3>User Information</h3>
                </div>
                <div class="classroom__side__bar__body">
      
                  <div class="card card__custom ">
                    <div class="card-body">
                      <!-- <h3 class="card-title">Special title treatment</h3> -->
                      <div class="card__contents">
                        <div class="card__content__group">
                          <div class="content__owner__img">
                            <img src="/_static_/<%= data?.teacher_info[0]?.dp_path %>" style="width:50px; height:50px; border-radius: 50px;">
                          </div>
                          <div class="content__sub__group">
                            <div class="content__owner__info">
                              <i class="fa-solid fa-at"></i><i><b> <%= data?.teacher_info[0]?.fname %> <%= data?.teacher_info[0]?.lname %></b></i>
                            </div>
                            <div class="content__body">
                              <p class="card-text">Role: Teacher</p>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="card__btn">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect teacher__remove__class__btn" data_c_r_id = "<%= data?.class_room_info[0]?.class_room_id %>"> 
                          remove class
                        </a>
                      </div>
                    </div>
                  </div>
      
                </div>
              </div>
            </div>
      
      
            <!-- row 2 take 10 cells -->
            <div class="classroom__data__container">
              <div class="classroom__data">
      
                <!-- post starts -->
                <div class="post__upload__form__container">
                  <div class="accordion" id="accordionExample">
                    
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="headingThree">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                          Add a post into the classroom ...
                        </button>
                      </h2>
                      <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                          <form class="row g-3" action = "/upload_content" method = "POST" enctype="multipart/form-data">
                            <input type="hidden" name="_csrf" value="<%= data?.CSRF_TOKEN %>">
                            <div class="col-md-12">
                              <label for="title" class="form-label">Add info</label>
                              <textarea class="form-control" id="input__post__text" name="title" placeholder="post something ..." rows = "3" required></textarea>
                            </div>
                            <div class = "col-md-8">
                              <label for="attachment" class="form-label">Attchment</label>
                              <input class="form-control" id="formFileLg" name="attachment" type="file" accept=".doc,.docx,.pdf">
                            </div>
                            <div class = "col-md-4">
                              <label for="classroom__id" class="form-label">Classroom ID</label>
                              <input class="form-control classroom__ID__holder" id = "classroom__id" name = "classroom_id" data-id = "<%= data?.class_room_info[0]?.class_room_id %>" type="text" value="<%= data?.class_room_info[0]?.class_room_id %>" readonly>
                            </div>
                            <div class="col-auto">
                              <button type="submit" class="btn btn-primary mb-3 btn-custom">Add post</button>
                            </div>
                          </form>
                          
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <% if(data?.class_room_posts.length === 0) { %>

                  <div class = "class_room_no_content">
                    <img src="/dev_v2/Classroom_teacher/img/err_svg_3.svg" alt="loading" height="300px" width="auto">
                    <div style="padding: 1rem; text-align: center;">
                    </div>
                  </div>

                <% }else{ %>
                  
                  <%
                    data?.class_room_posts.sort( (a,b) => {return  new Date(b.created_at) - new Date(a.created_at) })
                    console.log("sorted__post_arr")
                  %>
                  

                  <% data?.class_room_posts.forEach(post => { %>

                    <div class="post__container" data-id="<%= post?.class_post_id %>" data_room_id = "<%= post?.class_room_id %>">
                      <div class="post__header">
                        <div class = "post__header__side__1" >
                          <div class="data_post_owner_image">
                            <img class="post_profile_dp" src="/_static_/<%= post?.dp_path %>"
                              style="width:50px; height: 50px; border-radius: 50%;" />
                          </div>
                          <div class="post_owner_info">
                            <div class="data_post_owner">
                              <p><b>Posted by: <%= post?.fname %> <%= post?.lname %></b></p>
                            </div>
                            <div class="data_post_time">
                              <%
                                let dateTime = new Date(post?.created_at).toLocaleString("en-IN")
                                let date_part_1 = dateTime.slice(0, dateTime.length - 6)
                                let date_part_2 = dateTime.slice(-3)
                                let result__date = date_part_1 + date_part_2
                              %>
                              <p><i class="fa-solid fa-clock"></i> <%= result__date %></p>
                            </div>
                          </div>
                        </div>
                        
                        <div class="menu">
                          <button id="p_ID_<%= post?.class_post_id %>" class="mdl-button mdl-js-button mdl-button--icon">
                            <i class="material-icons">more_vert</i>
                          </button>
        
                          <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect util__post__btn__mui"
                            for="p_ID_<%= post?.class_post_id %>">
                            <li class="mdl-menu__item">Delete</li>
                          </ul>
                        </div>
                        
                      </div>
                      <div class="post__body">
                        <div class="post__body__content">
                          <%
                            let strings = post?.content.split("\r\n")
                            let html = "<h4>" + strings.join("</h4><h4>") + "</h4>";
                          %>
                          
                          <% strings.forEach(string => { %>
                            <h4><%= string %></h4>
                            
                          <% }) %>
                        </div>
                        <!-- attachment -->

                        <% if(post?.attachment) { %>
                          <div class="post__body__attachment">
                            <div class="attachment__component col-md-5">
                              <div class="attachment__wrapper">
                                <div class="attachment__img">
                                  <img src="/dev_v2/Classroom_teacher/img/pdf.png" style="width:50px; height: 50px;" />
                                </div>
                                <div class="attachment__info">
                                  <h4><i class="fa-solid fa-paperclip"></i> Attachment</h4>
                                  <h4  style = "word-wrap: break-word;"><a href="/download_content/<%= post?.attachment %>" style = "word-wrap: no-warp;"><%= post?.attachment %></a></h4>
                                  <h4>file</h4>
                                </div>
                              </div>
                            </div>
                          </div>
                        <% } %>
                        
                      </div>
                      <%
                        let comment_count = 0 
                        post?.post_comments.forEach(item => {comment_count++})
                      %>
                      <div class="post__comment__header" id = "ST_PRI_<%= post?.class_post_id %>" data_c_count = "<%= comment_count %>">
                        <button class="mdl-button mdl-js-button show__comments__btn">
                          <%= comment_count %> Comments <i class="fa-solid fa-angle-down"></i>
                        </button>
                      </div>
                      <div class="post__comment__container">
                        <%
                          post?.post_comments.sort((a,b) => {return  new Date(a.created_at) - new Date(b.created_at) })
                        %>
                        
                        <% if(post?.post_comments.length === 0) { %>
                            <!-- <div class="comment_item" style = "padding-left: 5rem; padding-top: 1.5rem; padding-bottom: 0.5rem;">
                              Nothing to show here ....
                            </div> -->
                        <% }else{ %> 
                          
                          <% post?.post_comments.forEach(item => { %> 
                          
                            <div class="comment__item" data_id = "<%= item?.comment_id %>" data_post_id = "<%= item?.class_post_id %>" data_room_id = "<%= item?.class_room_id %>">
                              <div class="comment__body__1">
                                <div class="comment__owner">
                                  <div class="comment__owner__img">
                                    <img src="/_static_/<%= item?.dp_path %>" alt="loading..." style="width:45px; height: 45px; border-radius: 50%;">
                                  </div>
                                  <div class="comment__meta">
                                    <div class="data_post_owner">
                                      <p><b>@<%= item?.fname %> <%= item?.lname %></b></p>
                                    </div>
                                    <div class="data_post_time">
                                      <%
                                        let dateTime_c = new Date(item?.created_at).toLocaleString("en-IN")
                                        let date_part_1_c = dateTime_c.slice(0, dateTime_c.length - 6)
                                        let date_part_2_c = dateTime_c.slice(-3)
                                        let result__date_c = date_part_1_c + date_part_2_c
                                      %>
                                      <p><i class="fa-solid fa-clock"></i> <%= result__date_c %></p>
                                    </div>
                                  </div>
                                </div>
              
                                <div class="comment__body">
                                  <h4><%= item?.content %></h4>
                                </div>
                              </div>
  
                              <% if(data?.teacher_info[0].teacher_id === item?.teacher_id) { %> 
  
                                <div class="menu">
                                  <button id="p_<%= item?.class_post_id %>_co_C_ID_<%= item?.comment_id %>" class="mdl-button mdl-js-button mdl-button--icon">
                                    <i class="material-icons">more_vert</i>
                                  </button>
                
                                  <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect util__comment__btn__mui"
                                    for="p_<%= item?.class_post_id %>_co_C_ID_<%= item?.comment_id %>">
                                    <li class="mdl-menu__item">Delete</li>
                                  </ul>
                                </div>
  
                              <% } %>
  
                              
              
                            </div>
  
                          <% }) %>


                        <% } %>
                        
                        
          
                        
                      </div>
          
                      <div class="post__reply__container"  data_room_id="<%= post?.class_room_id %>" data_post_id="<%= post?.class_post_id %>">
                        <div class="wrap">
                          <div class="comment_dp">
                            <img class="post_profile_dp" src="/_static_/<%= data?.teacher_info[0]?.dp_path %>" style="width: 40px; height: 40px; border-radius: 50%;" />
                          </div>
                          <div class="comment">
                            <input type="text" class="commentTerm" placeholder="Comment something..." required>
                            <button type="submit" class="commentButton">
          
                              <span class="material-icons-sharp">
                                send
                              </span>
          
                            </button>
                          </div>
                        </div>
                      </div>
          
                    </div>

                  <% }) %>
                  


                <% } %>
                
                <!-- post ends -->
                
                

      
              </div>
      
            </div>
      
      
          </div>
      
      
        </div>

        

      </main>

    </div>
    <div class="custom__modal__wrapper">
      <div class = "custom__modal__body">
        <div class="modal-content">
          <div class="modal-header">
            <h3 class="modal-title">Modal title</h3>
            <button type="button" class="close custom__close__btn" data-dismiss="modal" aria-label="Close">
              <span class="material-icons-sharp">
                close
                </span>
            </button>
          </div>
          <div class="modal-body">
            <h4 class = "modal-body-text">Modal body text goes here.</h4>
          </div>
        </div>
      </div>
    </div>
  <script src = "/dev_v2/Classroom_teacher/scripts.js"></script>
</body>
</html>